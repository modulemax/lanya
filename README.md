# 蓝牙家电开关控制系统





 毕业论文（设计）



基于51单片机的蓝牙家电开关控制系统




院        系 ：	机电工程学院
专        业：	微电子学
年级（班级）：	2012级
姓        名：	郑仁焜
学        号:	20124231039
指导教师：	孙玮
职       称：	教授
完成日期：	2016年5月20日

摘  要
本文设计了一个基于STC89C51单片机的蓝牙家电开关智能控制系统。该系统以STC89C51单片机和HC-05蓝牙模块为核心。该系统使用蓝牙来处理控制指令的接收与数据的传输，系统的开关自动控制模块使用4个继电器来完成。通过让具有蓝牙模块的智能手机终端与系统的HC-05蓝牙模块匹配，进而与之进行通讯，HC-05蓝牙模块将接收的数据通过串口通信传给单片机，单片机解析数据然后控制相应的继电器，从而实现对相应电路的控制。
关键词：单片机；无线控制；HC-05；蓝牙

目    录

1  引言	1
1.1 背景以及发展趋势	1
1.2 课题研究的目的和意义	2
1.3 系统的设计任务和要求	2
2  蓝牙家电开关控制系统方案设计	3
2.1　系统设计方案比较与可行性论证	3
2.2　系统设计方案的选择	4
3  蓝牙家电开关控制系统硬件设计	5
3.1 单片机最小系统设计	5
3.1.1 系统单片机型号的选择与论证	5
3.1.2 单片机最小系统电路设计	5
3.1.3 系统单片机最小系统电路测试	7
3.2 家电控制电路设计	7
3.3 HC-05蓝牙通信系统设计	8
3.3.1 蓝牙型号的选取及论证	8
3.3.2 蓝牙通信电路设计	9
3.3.3 蓝牙模块功能测试	9
3.3.4 蓝牙模块与手机蓝牙之间的设置与匹配	10
3.4 系统显示电路设计	12
4  蓝牙家电开关控制系统软件设计	13
4.1 系统软件编程环境介绍	13
4.2 系统主程序流程图	13
4.3 系统蓝牙通信模块子程序	15
5  系统的组装与调试	16
5.1 系统的组装与焊接	16
5.2 系统的调试	16
5.3 系统的功能测试与检验	17
6  结论	18
谢辞	19
参考文献	20
附录A 系统硬件实物图	20
附录B 系统电路图	22
附录C 系统源程序	23





基于51单片机的蓝牙家电开关控制系统
1  引    言
1.1 背景以及发展趋势
近些年来，我国智能家居市场迅速发展，消费者需求日益增长，随着科学水平不断提升、科学技术的不断创新、生活水平的不断提高，较早的家庭住宅设计之初对家用电器开关的预留相对较少，传统的机械式开关越来越无法满足不了人们追求完美生活的需求，无线控制技术取代传统的手动控制[1]，已成为现代生活的一种时尚，因而传统的机械式开关必将被新的科技产品所取代，通过远程智能控制器完成对家中终端的智能化控制操作成为了现实[2] 。
 智能开关规模的急速壮大主要原因是：随着技术的发展，以及物联网技术和云计算技术的引入，智能手机和宽带业务的普及奠定了智能开关行业的普及基础[3]。
无线技术的发展使智能开关走进人们的生活，在不久将来便捷家居的建设将为远程开关控制的发展奠定了坚实基础。通过无线技术远程操纵家电开关实现家电智能化。无线控制开关不需要布线，就能实现对家电的便捷灵活控制和对大部分的家电进行时间控制。
1900年开始其他国家的无线遥控开关系统的推广和应用比国内发展较早了近20年，计算机行业中，我们知道具有蓝牙文件上传功能的笔记本电脑，这是典型的早期的蓝牙传输的蓝牙无线打印应用。进入二十一世纪以来，蓝牙技术已经被众多的手机厂商所应用[4]，正是由于手机蓝牙的应用，使蓝牙技术由传统的工业应用发展到了日常应用，各种手机蓝牙控制设备也逐步被开发和推广应用。
从14年以来，可穿戴的智能设备、云计算、大数据等相继作为科技界的热点，受到人们持续追捧。而智能开关控制涵盖了智能控制端、无线技术等，是未来智能技术的热土。科学技术的不断成熟与智能设备的改进，科学技术将改变我们的生活，专家预计到2020年，智能开关控制产值将会到达3千亿美元。如今，智能手机以成为我们生活中不可或缺的一部分，而且无线控制技术的发展及市场的使用率，将会决定以后人们的生活方式以及智能家居以后的发展方向。


1.2　课题研究的目的和意义
微电子技术、自动控制技术与通信技术的发展将我们的生活带入了奇妙的世界，其中生活环境的科技化、人文化也更加受到关注，用移动通信技术与单片机的蓝牙家电智能控制开关系统，慢慢在科技住宿场所取得到了很好的推广和使用，并且赢得了很好的评价。人们的生活应科学技术的飞速发展获得了极大的便利，各种电子控制系统应用于生活的每一个角落。
使用具有蓝牙模块的手机对家电进行控制具有划时代的进步，我们不再为一个电器而到处找它的遥控，因为一般的生活电器的操作控制都有自己单独大的遥控器，并且也只有它自己的遥控能对其控制，而现在的手机蓝牙控制技术让大部分的控制器能够扔到一边了，都使用手机蓝牙遥控，这不仅仅节省了给遥控器更换电池所耗费的成本和找遥控器的时间，这也使操作得到了便捷性和智能化。
根据自己所掌握的知识和蓝牙家电开关控制系统的所需达到的功能和成品的价格限制，本设计使用STC89C51单片机、安卓蓝牙模块、智能控制技术实现了一套以STC89C51单片机为控制中心的无线家电开关控制系统[5-6]。本系统主要包括单片机控制模块，液晶显示器模块，HC-05蓝牙通信模块，自动控制模块五大模块组成。该系统具有模块少、实用性高、价格低，使用方便，可扩展性强的优点。所以，在市场上推广有很高的可行性，在技术研究发展上也具有很大的学习和开拓意义。
1.3　系统的设计任务和要求
本系统使用STC89C51单片机为主控芯片，HC-05蓝牙为通讯模块，通过硬件实物结合软件编程来完成无线蓝牙家电开关控制系统的设计和制作。该系统主要模块包括：单片机控制系统、HC-05蓝牙通讯模块、液晶LCD12864显示器电路、继电器开关电路。该无线控制系统所的主要元器件包括：STC89C51单片机、HC-05蓝牙模块、LCD12864液晶显示器、DC-5V继电器开关。
该系统主要的设计功能和要求包括：（1）HC-05蓝牙通讯模块接收到手机蓝牙模块发送的特定指令后将对其进行相应指令分析；（2）该系统要有能够显示当前所控制开关的使用的状态；（3）电器的当前状态要有相应的指示灯进行提示；（4）本设计要求具有4个能独立控制的生活电器开关的开启与关闭状态转换控制，相互之间不能有干扰。 
2  蓝牙家电开关控制系统方案设计
2.1　系统设计方案比较与可行性论证
根据系统的功能要求，通过互联网和图书馆查阅大量相关资料和论证，最终得出三种设计思路对其进行相应的思考和讨论，并对相应的思路进行论证和可行性的分析，最终采取其中最好的设计方案作为本次设计的最终选择方案。
方案一：采用NRF24L01无线射频方式进行遥控控制[7]，采用此方案进行设计的硬件框图如图2-1所示。


图2-1为方案一的硬件结构设计框图，采用此方案进行开发有低成本，开发容易等优点，便于后期的广泛推广和使用；但也有比较明显的缺点就是发射器端也要有相同的单片机系统进行操作，想要远程控制开关就要一直拿着发射器设备，使用起来不够方便，并且因为不同的遥控设备没有设置安全密码，这样就容易被旁边同样频段的遥控设备误操作和恶意控制。
方案二：采用GSM移动通信网络的方式进行远程控制，系统通过手机远程发送短信的模式实现家用电器的开启和关闭[8]，采用此方案进行设计的硬件框图如图2-2所示。











图2-2  方案二系统框图
图2-2是方案二的主要模块设计框图，使用这一方案进行设计具有使用简便，可以只带一个手机控制器就能对开关远程控制和监控，其最大的有点事控制开关不用受到距离的限制；相应的不利的地方是设计的难度大，而且这种方案的成本也比较高，引文使用手机发送短信对系统进行控制需要花费相应大短信费，所以这一方案在大多的家庭场所推广有较大的难度。
方案三：采用智能手机蓝牙软件进行远程操控，用户通过手机软件蓝牙发送指令实现家电开关的远程开启和关闭，采用此方案进行设计的硬件框图如图2-3所示。









图2-3  方案三系统框图
图2-3是方案三的主要模块设计框图，使用这一方案来设计，拥有遥控简便灵活，而且不需要携带另外的控制器就能够对多个电器进行的远程的开关操作，同时手机蓝牙在连接的时候有密码匹配，这就保证了连接的保密性和安全性，而且这方案不需要花费相应的移动通信费。
2.2　系统设计方案的选择
通过对以上三种方案的比较和分析论证，现在的人们都比较喜欢简捷、便利的生活方式，在这个生活环境中方案一虽然具有使用价格比较低、开发难度低的有点，但是因该方案缺乏安全性以及使用繁琐，所以用这个方案设计的系统不能在市场获得较好的推广，因此在在三个设计方案进行分析对比后，首先排除了方案一。而剩下的两种方案是当前无线控制系统比较好的两种解决方案，两种方案各有好坏，方案三相比方案二开发比较简单，开发时间短，市场推广教容易，方案二通过手机发送短信进行远程控制，所以用户需要支付一定的短信通信费用，而且一但手机停机了，就会出现无法进行远程遥控控制的情况。通过对以上三种方案的对比分析，本论文选择的是方案三作为本论文的设计方案。
3  蓝牙家电开关控制系统硬件设计
3.1 单片机最小系统设计
3.1.1 系统单片机型号的选择与论证
单片机为整个系统的控制核心，选择一款合适的单片机对整个系统设计的成功与否起着至关重要的作用，目前市场上单片机种类型号千差万别，从基础的8位单片机到高端的64位单片机[9]，价格从几元到上百元不等，如此众多的单片机，如何才能选择一款适合本设计的型号呢？首先要从设计的功能上着手，由于系统功能相对较少，只是实现与HC-05模块的通信以及继电器控制指令的发出，因而不需要选择引脚多的太高端的单片机；其次要考虑到设计的成本要求，目前市场上8位单片机相比16位以上单片机具有很好的价格优势，考虑到8位单片机完全能够达到设计的功能要求，因而本设计首选单片机是8位单片机；最后还需要考虑到单片机在设计过程中程序编译调试的可操作性以及实用性，鉴于以上各种原因考虑，本设计最终选择市场上较为普及的8位单片机作为系统的单片机，具体型号选择STC89C51单片机。 
3.1.2 系统单片机最小系统电路设计
单片机最小系统电路为整个系统的运行基础，只有最小系统正确搭建，系统才能正常运行，该电路主要由STC89C51单片机、晶振电路、复位电路组成，此部分电路图如图3-1所示。

图3-1  单片机最小系统电路图
系统主控电路由单片机、时钟振荡电路与复位电路组成[10]。STC89C51中有一个构成内部振荡器的高增益反相放大器，引脚XTAL1和 XTAL2分别是该放大器的输入和输出端，用于外接晶体振荡器，Y1为11.0592M的晶体振荡器，选择11.0592M是为了便于计算单片机运行的周期，Y1两端的电容 C4，C5 接在放大器的反馈回路中构成并联振荡电路。电容C4和C5应选择瓷片电容，只是电容的容量大小会轻微影响振荡频率的快慢、振荡器工作的稳定性、起振的难易程度。如果使用石英晶体，推荐电容使用30pF士l0pF。
STC89C51为高电平复位使能，在最小系统电路设计中需要确保系统上电的时候能够复位单片机，单片机的复位电路就好比电脑的重启功能一样，如果电脑在使用中出现运行错误、死机的情况，按下重启按钮电脑就能重新开启。单片机的复位电路也一样，当系统在运行时，受到外部因素的影响，发生程序跑飞或出错的情况，这时按下复位按钮，系统就会正确的重新运行，因而单片机复位需要有上电复位和按键复位两种复位方式，复位电路设计如图3-1所示，其中 S2为复位按键。上电复位的工作原理为：通电时，电容两端相当于短路，于是RST引脚上为高电平，然后电源通过电阻对电容C3充电，RST端电压慢慢下降，降到一定程度，即为低电平，单片机开始正常工作；按键复位的工作原理为：当S1被按下后，电容C3迅速放电,使RST引脚为高电平，从而实现复位[11]。
3.1.3 单片机最小系统电路测试
单片机最小系统电路设计完成后，首先要验证一下最小系统电路是否能够工作，首先要保证晶振正常起震，检测晶振起震可以用示波器观察晶振引脚的输出波形，观察是否有震荡波形输出，如果晶振起震，最小系统基本就可以工作了，然后单片机置入相应的IO 端口控制程序，此时可以控制一个简单的ＬＥＤ灯的亮灭来验证程序是否正常运行。我们还要验证单片机最小系统的复位电路是不是能够正常使用。
3.2 家电控制电路设计
该系统的控制模块采用4路继电器来完成，4路继电器分别控制一个开关，开关的状态用led灯来显示。该电路使用弱电控制强电的原理，单片机系统通过改变相应引脚的高低电平，以此来控制4个继电器的断开和闭合，进而来控制外部电路的通断，具体的电路如图3-8所示。
如图3-2所示，P14-P17分别接到单片机的IO口上，当单片机输出低电平的时候三极管接通，继电器外部开关闭合，外接的家电启动工作；当单片机输出高电平的时候三极管断开，继电器外部开关断开，外接的家电停止工作。由于现在是设计阶段，为了能够直观的看出继电器的开闭状态，用LED灯来替代外部电器，当对应家电的LED灯点亮，就表明对应电器的电源闭合，家电现在是运行状态，当对应家电的LED灯灭了，就表明对应的电器电源断开，家电处理停止状态。

图3-2  系统家电控制电路图
3.3 HC-05蓝牙通信系统设计
3.3.1 蓝牙型号的选取及论证
现在市场上使用最广的蓝牙是2.0的蓝牙模块，只有个别的高端手机上面采用蓝牙4.0的蓝牙接口，大部分的手机还都使用蓝牙2.0模块，考虑到通用性和兼容性，本系统使用标准的蓝牙2.0作为系统的蓝牙模块。
常用的蓝牙2.0标准的模块有HC-05和HC-06两种[12]，下面通过对两种蓝牙模块的介绍和对比论证，选择其中一款蓝牙模块作为系统的蓝牙通信设计方案。
方案一：采用HC-05蓝牙模块，这是一款高实用性的主从一体、串口通信蓝牙芯片，它能够和大部分带有蓝牙传输功能的智能设备配对，HC-05蓝牙模块所支持的波特率范围很大，范围是：4800-1382400。该蓝牙模块不仅兼容5伏和3.3伏电源的单片机芯片，而且它的使用起来方便，各方面的文档齐全，连接匹配灵活还拥有很高的性价比，HC-05蓝牙模块是属于工业级的电子产品，不仅性能稳定而且可靠性还很高。
方案二：采用HC-06蓝牙模块，HC-06蓝牙为从设备，他可以与其它2.0标准的蓝牙设备之间进行通信。这个蓝牙模块仅能作为从设备，不能充当主设备来使用。由于HC-06模块定位是普通的应用级别的蓝牙芯片，所以它在使用的可靠性和运行的稳定性上要比HC-05表现的不理想，但是其价格相对于HC-05来的低，在某些场合表现的很好，比如对产品的价格有比较高的要求的应用场合就很普及。
通过对以上的两种蓝牙芯片的优劣比较，考虑到本系统对蓝牙的实用性和稳定性的要求较高，而且蓝牙也是系统的核心模块，所以系统采用了较符合要求的HC-05蓝牙模块作为本系统的最终选择




3.3.2 蓝牙通信电路设计
本系统的无线数据接收电路使用HC-05蓝牙模块作为核心，再加以外围电路完成本系统的无线数据传输功能，具体电路如图3-3所示。

图3-3  HC-05通信模块电路图
如图3-3所示，U6为系统蓝牙通信模块HC-05模块，为了使系统能够在5伏和3.3伏的电压下正常工作，系统使用两个二极管D5与D6和两个电阻R10与R11组成电压转换电路。 D7是HC-05模块运行状态的指示灯，它的工作状态可以分为这三种：一，当蓝牙处于AT状态时，BS-KEY引脚电平为高电平，D7指示灯亮一秒，暗一秒不断反复，此时它的波特率是38400。二，当模块要进入可配对的状态时，将在HC-05上电的同时并把BS-KEY引脚设置为低电平（或者接地），此时D7指示灯以一秒闪烁2次的频率快闪。三，当模块处于配对成功状态时，D7指示灯将会双闪，也就是一次会闪2下，周期为2s。有了指示灯我们就能够根据它的亮灭情况，很快的看出模块的运行状态，给我们带来了很大的便利。
3.3.3 蓝牙模块功能测试
蓝牙模块电路设计焊接好后，为了保证模块能够正常使用，首先要测试一下蓝牙模块收发功能是否正常，具体测试过程如下所述。
首先HC-05模块通过usb转TTL模块连接到电脑串口，连接方式如图3-4所示。

图3-4  蓝牙模块与TTL模块接线方式图
HC-05蓝牙模块出厂设置为从模式，与电脑连接后，我们发送AT+ROLE，将会返回+ROLE：0，也可以通过发送AT+ROLE=1将HC-05设置为主机模式，如果返回OK，则说明蓝牙设置成功，详细的设置界面截屏如图3-5所示。
3.3.4 蓝牙模块与手机蓝牙之间的设置与匹配
将系统的HC-05蓝牙模块通过电脑设置为从设备，把将要测试的智能手机安装好蓝牙家电开关 拜拜控制软件。打开安装好的软件，点击右上角的更多按钮，让后选择搜索蓝牙设备，当搜索到要连接的HC-05后，点击链接。具体操作过程可以参考图3-6。


图3-5  蓝牙模块测试界面图
图3-6  蓝牙配对操作演示过程图
3.4 系统显示电路设计
方案一数码管显示。
数码管是一种半导体发光器件，它的基础单元为发光二极管。数码管按照段数可以分为七段数码管和八段数码管两种。如果按照发光二极管单元连接方式的不同，可以分为共阳极数码管和共阴极数码管两种。系统使用数码管来显示信息具有高亮度、显示效果清晰、使用的电压低、寿命长和便宜等特点；不足地方是信息显示内容较少少，而且当显示内容是字符时，显示效果明显不如字符型液晶显示器。
方案二LCD液晶显示。
采用点阵字符型 LCD 液晶显示，液晶显示模块具有体积小、功耗低、显示内容丰富等特点[13]，现在字符型液晶显示模块已经是单片机应用设计中最常用的信息显示器件，但采用LCD液晶显示会造成设计成本增加。
综合方案一与方案二的优缺点，考虑到为了提高显示效果，系统最终采用方案二做系统的显示器件，系统选用LCD12864作为显示部分。LCD12864液晶显示电路如图3-9所示。

图3-7  系统显示器件电路图
4  蓝牙家电开关控制系统软件设计
4.1 系统软件编程环境介绍
本系统的程序部分采用C语言来编写，编译环境为Keil开发软件。本设计使用c语言是因为，和汇编相比，C语言是一种比较高级的语言，在开发难易上、程序结构上、后期维护性和可移植上有较明显的优点，并且c语言更容易学习和使用。
Keil c51 软件提供了教全面的库函数和功能完善的集成开发调试工具，全图形用户界面。Keil C51 可以完成编辑、编译、连接、调试、仿真等整个开发流程[14]。开发人员可用IDE 本身或其它编辑器编辑C 或汇编源文件，然后分别有C51 及A51 编辑器编译连接生成单片机可执行的二进制文件（.HEX），然后通过单片机的烧写软件将HEX 文件烧入单片机内。
软件主要分为三个方面：一是系统的初始化；二是采集数据；三是数据处理并进行显示。程序结构使用模块化的编程结构，这样子的程序结构更加清晰，逻辑清楚而且便于后期调试与修改[15-16]。
4.2 系统主程序流程图
该系统主程序主要有这几个部分：系统的各项参数初始化、蓝牙数据接收与解析、数据的显示以及开关电路的输出控制。
系统的主程序如4-1所示，一个完整的软件总少不了初始化程序，当系统启动后，程序对系统的各个模块进行的初始化。该系统的初始化程序主要由：液晶显示器初始化、蓝牙串口模块初始化、控制信号电平的初始化等组成。初始化程序完成以后，系统首先要启动蓝牙串口通信模块，保证蓝牙模块和手机蓝牙控制终端完成匹配。单片机与蓝牙使用串口通信的方式实现数据的交互，软件部分的数据接受程序对蓝牙接收到的指令，进行解析然后控制相应引脚的电平，从而控制继电器的闭合与开启，实现对家电开关的控制[17-18]。液晶显示程序根据当前状态，显示4路家电开关的开启和关闭状态，便于直观的测试。 
4.3 系统蓝牙通信模块子程序
系统的蓝牙通信程序的主要功能是接收手机蓝牙发送的控制指令，这个部分的程序成功与否对该系统软件设计非常之重要。图4-2为系统蓝牙通信子程序流程图。































图4-1  系统主程序流程下图



























图4-2  系统蓝牙通信子程序流程图
5  系统的组装与调试
5.1 系统的组装与焊接
1.元件在安装时，注意事项如下：
1) 安装元器件的时候，相互之间的间距应该要保持在1～2mm。
2) 装配元器件的时候，先安装那些要用机械固定的	元器件，在这系统中如单片机芯片、液晶显示器。


3) 安装各个元件时,要注意元件的朝向，要让元件的标记朝着上方或容易识别的方向，而且要注意各元件标记的读书方向相同 (从左边到右边或从上面到下面)。
2. 元件在焊接时，应注意以下几个方面：
在进行元器件焊接之前，考虑到元器件的长期放置它的引脚会氧化，所以要先用纱布或别的工具将引脚打磨一遍，通过这种方式将元件引脚的氧化部分去除掉；在焊接过程中还要把握锡的用量，因为过多的话可能会引起元件引脚的短路，过少的话会造成虚焊；焊接时，应注意尽量避免因元器件的发热而导致的铜箔对基板附着力的降低；要避免元器件裸露出来的铜盘可能会与导线相接触从而导致短路；在元器件焊接好了后，可以给发热量较大的芯片安装上散热片，这用有利于散热增加系统的稳定；焊好后可以在电路板的四个角装上四个铜柱。
通过以上步骤，一个完整的电路硬件部分就制作成功了，这时可以再认真检查一下是否有元器件少焊或者焊错的情况，这样可以保证电路焊接的正确。
5.2 系统的调试
在焊接好电路板实物后，接下来很关键的工作就是调试了。系统的调试是整个设计很关键的步骤。因此我们要细心冷静，还要掌握有一定的电路分析技巧。当然由于该系统软硬件结合，调试的时候也需要软硬件一起调试。
在软硬件结合调试的过程中应注意以下问题：
1、第一步测试先不要插单片机芯片和蓝牙模块，先用万用表测量一下重要位置的电压。这样可以保证模块安装后，模块的工作电压正常，不至于单片机和蓝牙模块因工作电压过高烧坏芯片或者模块，造成不必要的浪费。
2、测试过程中液晶屏幕不亮，经检查是液晶背光调节的问题，接上背光后问题解决；
3、在手工焊接调试时还出现了P0口忘记接上拉电阻造成系统显示器工作不正常。
4、系统运行之前先要对HC-05蓝牙模块进行功能测试，确保HC-05蓝牙模块没有错误，能够正常的接收指令。



5.3 系统的功能测试与检验
蓝牙家电开关控制系统的测试内容主要为，对4路继电器的能否正确的开启和关闭进行测试。为了方便看出系统功能是否正常，我们用led指示灯来代替家用电器，通过观察LED灯的亮灭来测试，手机可以用快捷按键来发送相应指令，也可以直接发送具体指令来控制继电器，为了测试更直观我选用发送具体指令的方式。具体测试过程如下所述。
手机蓝牙指令“o11”和“o10”控制第一路继电器的的开启和关闭，现在用手机蓝牙发送指令“o11”,继电器1吸合，LED1点亮，发送指令“o10”继电器1断开，LED1熄灭，继电器吸合状态如图5-1。
图5-1  系统继电器1吸合状态图
手机蓝牙指令“o21”和“o20”控制第二路继电器的的开启和关闭，现在用手机蓝牙发送指令“o21”,继电器2吸合，LED2点亮，发送指令“o20”继电器2断开，LED2熄灭，继电器2吸合状态如图5-2。


图5-2  系统继电器2吸合状态图
手机蓝牙指令“o31”和“o30”控制第三路继电器的的开启和关闭，现在用手机蓝牙发送指令“o31”,继电器3吸合，LED3点亮，发送指令“o30”继电器3断开，LED3熄灭，继电器3吸合状态如图5-3。
图5-3  系统继电器3吸合状态图
手机蓝牙指令“o41”和“o40”控制第三路继电器的的开启和关闭，现在用手机蓝牙发送指令“o41”,继电器4吸合，LED4点亮，发送指令“o40”继电器4断开，LED4熄灭，继电器4吸合状态如图5-4。
	图5-4  系统继电器4吸合状态图	














6  结论
本论文设计的蓝牙家电开关控制系统主要有如下功能和特点：
1、系统能够通过手机蓝牙软件对4个继电器进行远程开关控制。
2、系统能够通过液晶显示器模块，实时显示4路开关的当前工作状态。通过液晶显示器可以很快的看出，单片机对手机蓝牙发送的控制指令能否正确的接收和解析，更加的人性化。
3、有功耗低、操作方便、性能稳定等诸多优点，具有良好的应用和推广价值。
本系统使用的各个模块电路设计简单稳定，通过软件和硬件结合，已经达到了系统的要求。具有一定的开发使用价值。但是由于时间仓促，自己经验不足，在理论方面也相应存在缺陷，现总结如下：
1、在对系统各个模块的电源电路设计的不够理想，导致需要焊接更多的连线。
2、系统模块设计师，没有考虑扩展更多电路，比如居住环境温度、湿度的监测功能；通讯接口电路与上位机（PC机）结合，然后使用相关技术实现系统与上位机的数据连接，通过这种方式就能达到超远距离控制开关的目的，弥补的系统的不足之处。
3、在选择芯片的时候对各种实用芯片的价格了解不够，在选择上有欠缺，如所选的液晶显示模块价格较贵，从而使设计成本有所提高。
针对这些不足，将来的设计应注意电源方面的安全和优化，可以考虑增加LDO电源管理芯片进行系统的稳压；给该系统加上外封装，减小外界对元器件的损害，从而提高系统的使用寿命。








谢    辞
通过这一阶段的努力，我的毕业论文终于完成了，这意味着大学生活即将结束。在大学阶段，我在学习上和思想上都受益非浅，这除了自身的努力外，与各位老师、同学和朋友的关心、支持和鼓励是分不开的。这次毕业设计让我从中学到了很多课本上学不到的东西，比如做事要认真、踏实。并且掌握了如何去从零去完成一个设计，包括市场的分析，资料的搜集等。通过自己亲自动手和调试我明白的实践的重要性，明白了理论结合实践的含义。
非常感谢孙老师在我大学的最后学习阶段——毕业设计阶段给自己的指导，从开始的选题，到资料收集，到写作、修改，到论文定稿，她们给了我细心的指导和无私的帮助。




参 考 文 献
[1] 张鑫.基于蓝牙的家居控制网络应用研究[D].辽宁:大连理工大学, 2009.
[2] 于朔.基与AT89S51单片机的家电智能控制器的硬件设计[J].中国科技博览, 	2015, (38):232-232.
[3] nielsen.智能手机全球普及率调查[J].计算机应用文摘, 2013(10):1-1.
[4] 吴瑞.蓝牙技术在手机领域的应用及发展[J].电子测试, 2003(07):28-31.
[5] 沈梁,王鑫荣,陈文召.蓝牙技术原理与技术综述[J].无线电工程, 2005, 31(9):17-20.
[6] 张俊谟.单片机中级教程[M].北京:北京航空航天大学出版社,2006:113-118.
[7] 付聪,付慧生,李益青.基于nRF24L01的无线温度采集控制系统的设计[J].工矿自动化, 2010, 36(1):73-75.
[8] 孔超.基于GSM无线网络的远程数据传输系统[D].江苏:南京理工大学, 2007.
[9] 李刚,陈世利,周鑫玲.飞思卡尔8位单片机实用教程[M].北京:电子工业出版社, 2009.
[10] 张毅刚.单片机原理及应用[M].北京:高等教育出版社,2008:104-110.
[11] 张毅刚,彭喜元,董继成.单片机原理及应用[M].北京:高等教育出版社,2003:78-84.
[12] 蓝牙资料[EB/OL].(2015-04-8)[2015-07-13]. 
    http://http://baike.baidu.com/view/1028.htm.
[13] 史良. LCD12864显示模块与微处理器的接口设计[J].矿业安全与环保, 1999(05):16-17.
[14] 鲁杰爽.单片机Keil软件仿真与调试技巧[J].电子制作, 2010(08):50-52.
[15] 孙鉴. KEIL μ Vision 2环境下仿真单片机程序[J].计算机辅助工程, 2006(02):74-77.
[16] 先锋工作室.单片机程序设计实例[M].北京:清华大学出版社, 2003:133-147.
[17] 李华,孙晓民,李红青. MCS-51系列单片机实用接口技术[M].北京:北京航空航天大学出版社, 2004:214-287.
[18] 王幸之. AT89系列单片机原理与接口技术[M].北京航空航天大学出版社, 2004:76-102.







附录A 系统硬件实物图

















附录B 系统电路图















附录C 系统源程序
#include "reg52.h"
#include "uart.h"
#include "sbit.h"
#include "lcd.h"
  
 unsigned char flag_REC;
 unsigned char buff[20]=0;

void main()
{
   Uart_init();
   lcd_init();
	P2= 0xff;
	LED5=0;
	LED5=1;
   while(1)
     {	  
		 if(flag_REC==1)				    //
	     {
	     	flag_REC=0;
	    	if(buff[0]=='o')	
//第一个字节为O，第二个字节为N，第三个字节为控制码
		    	switch(buff[1])
		        {
			      case '1' : 	if(buff[2]=='0')
				  				LED1=1;
				  			else
				  				LED1=0;
				  			break;
			      case '2':	if(buff[2]=='0')
				  				LED2=1;
				  			else 	LED2=0;
				  			break;				   
			      case '3':  if(buff[2]=='0')  LED3=1;
				  			else  LED3=0;
				  			break;
			      case '4':  if(buff[2]=='0')   LED4=1;
				  			else	  LED4=0;
				  			break;			 
			  }					 
	      }  
		  if(LED1==0)
	      		write_string(0x82,"ON ");
		  else
		  		write_string(0x82,"OFF");
		  if(LED2==0)
	      		write_string(0x8a,"ON ");
		  else
		  		write_string(0x8a,"OFF");
		  if(LED3==0)
	      		write_string(0xc2,"ON ");
		  else
		  		write_string(0xc2,"OFF");
		  if(LED4==0)
	      		write_string(0xca,"ON ");
		  else
		  		write_string(0xca,"OFF");
	   delay(20); 
     }
}
//  通讯中断接收程序   中断函数无返回值
  void uart_rx(void)  interrupt 4	using 3	  
//放在这里 和放在main（）里面是一样的
 {
   unsigned char i;
	unsigned char flag;
	unsigned char dat;
    if(RI)	                 //是否接收中断
    {
       RI=0;
       dat=SBUF;
       if(dat=='o'&&(i==0)) //接收数据第一帧
       {
            buff[i]=dat;
            flag=1;        //开始接收数据
       }
       else
	      if(flag==1)
	      {
		      i++;
		      buff[i]=dat;
		      if(i>=2)
	          {
			   i=0;
			   flag=0;
			   flag_REC=1 ;
		      }  // 停止接收
	      }
	 }
 }
